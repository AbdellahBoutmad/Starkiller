import{_ as c}from"./TagViewer.b07ca85a.js";import{_ as d}from"./ExpansionPanelFilter.5838fe52.js";import{_ as u}from"./ExpansionPanelSearch.7dcac59a.js";import{_ as p}from"./ListPageTop.dad49f81.js";import{l as g}from"./index.e9f2ede5.js";import{g as m}from"./tag-api.5e19879c.js";import{n as h,by as f,bz as v,bA as y,bB as T,r as l,b as C,c as i,k as b,l as r,V as o,o as x}from"./index.154e9cc6.js";import{_ as k}from"./VExpansionPanels.1f915cd7.js";import{_ as w}from"./VDataTable.71ce8bb9.js";import{_ as $}from"./VSelect.27a57f2b.js";import"./VExpansionPanelHeader.d8fbc23c.js";import"./VBreadcrumbs.a2278375.js";import"./index.27090f0f.js";const S={name:"Credentials",components:{ExpansionPanelFilter:d,ExpansionPanelSearch:u,TagViewer:c,ListPageTop:p},data(){return{breads:[{text:"Credentials",disabled:!0,href:"/credentials"}],headers:[{text:"id",value:"id"},{text:"CredType",value:"credtype"},{text:"Username",value:"username"},{text:"Password",value:"password"},{text:"Domain",value:"domain"},{text:"Host",value:"host"},{text:"Tags",value:"tags",width:300},{text:"Actions",value:"actions",sortable:!1}],selected:[],selectedTags:[],tags:[],credentials:[],search:"",debouncedGetCredentials:g(this.getCredentials,500),loading:!1}},computed:{showDelete(){return this.selected.length>0}},watch:{search(){this.debouncedGetCredentials()},selectedTags(){this.debouncedGetCredentials()}},mounted(){this.getCredentials(),this.getTags()},methods:{async getTags(){const s=await m({page:1,limit:-1,sources:"credential"}),e=[];s.records.forEach(t=>{e.find(n=>n.name===t.name&&n.value===t.value)||e.push(t)}),this.tags=e},deleteTag(s,e){f(s.id,e.id).then(()=>{s.tags=s.tags.filter(t=>t.id!==e.id),this.getTags()}).catch(t=>this.$snack.error(`Error: ${t}`))},updateTag(s,e){v(s.id,e).then(t=>{const a=s.tags.findIndex(n=>n.id===t.id);s.tags.splice(a,1,t),this.getTags(),this.$snack.success("Tag updated")}).catch(t=>this.$snack.error(`Error: ${t}`))},addTag(s,e){y(s.id,e).then(t=>{s.tags.push(t),this.getTags()}).catch(t=>this.$snack.error(`Error: ${t}`))},async getCredentials(){this.loading=!0;try{this.credentials=await T({tags:this.selectedTags,search:this.search})}finally{this.loading=!1}},create(){this.$router.push({name:"credentialNew"})},async deleteCredential(s){await this.$root.$confirm("Delete",`Are you sure you want to delete credential ${s.id}?`,{color:"red"})&&this.$store.dispatch("credential/deleteCredential",s.id)},async deleteCredentials(){await this.$root.$confirm("Delete",`Are you sure you want to delete ${this.selected.length} credentials?`,{color:"red"})&&this.selected.forEach(s=>{this.$store.dispatch("credential/deleteCredential",s.id)})},async copyToClipboard(s){try{await navigator.clipboard.writeText(s),this.$snack.success("Output copied to clipboard")}catch{this.$snack.warn("Failed to copy to clipboard. You must be on HTTPS or localhost.")}}}};var E=function(){var e=this,t=e._self._c;return t("div",[t(p,{attrs:{breads:e.breads,"show-create":!0,"show-refresh":!0,"show-delete":e.showDelete},on:{create:e.create,refresh:e.getCredentials,delete:e.deleteCredentials}}),t("div",{staticStyle:{display:"flex","flex-direction":"row","flex-wrap":"wrap"}},[t(l,{staticClass:"mr-2 pa-2",staticStyle:{"flex-basis":"250px"},attrs:{elevation:"2",outlined:""}},[t(k,{staticClass:"mb-6",attrs:{multiple:""}},[t(u,{attrs:{title:"Search",label:"Search"},model:{value:e.search,callback:function(a){e.search=a},expression:"search"}}),t(d,{attrs:{title:"Tags",label:"label","item-key":"id","item-value":"label",items:e.tags,"empty-default":!0},model:{value:e.selectedTags,callback:function(a){e.selectedTags=a},expression:"selectedTags"}})],1)],1),t(l,{staticStyle:{flex:"1","min-width":"0"},attrs:{elevation:"2",outlined:""}},[t(w,{attrs:{loading:e.loading,headers:e.headers,items:e.credentials,"item-key":"id",dense:"","show-select":""},scopedSlots:e._u([{key:"item.id",fn:function({item:a}){return[t("router-link",{staticStyle:{color:"inherit"},attrs:{to:{name:"credentialEdit",params:{id:a.id}}}},[e._v(" "+e._s(a.id)+" ")])]}},{key:"item.username",fn:function({item:a}){return[t("div",{staticClass:"point",on:{click:function(n){return e.copyToClipboard(a.username)}}},[e._v(" "+e._s(a.username)+" "),t("i",{staticClass:"fa fa-paperclip center-icon"})])]}},{key:"item.password",fn:function({item:a}){return[t("div",{staticClass:"point",on:{click:function(n){return e.copyToClipboard(a.password)}}},[e._v(" "+e._s(a.password)+" "),t("i",{staticClass:"fa fa-paperclip center-icon"})])]}},{key:"item.tags",fn:function({item:a}){return[t(c,{attrs:{tags:a.tags},on:{"update-tag":function(n){return e.updateTag(a,...arguments)},"delete-tag":function(n){return e.deleteTag(a,...arguments)},"new-tag":function(n){return e.addTag(a,...arguments)}}})]}},{key:"item.actions",fn:function({item:a}){return[t($,{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:n,attrs:_}){return[t(C,e._g(e._b({attrs:{text:"",icon:"","x-small":""}},"v-btn",_,!1),n),[t(i,[e._v("fa-ellipsis-v")])],1)]}}],null,!0)},[t(b,{staticClass:"ml-2 mr-2"},[t(r,{key:"edit",attrs:{link:""}},[t("router-link",{staticClass:"text-decoration-none",staticStyle:{color:"inherit"},attrs:{to:{name:"credentialEdit",params:{id:a.id}}}},[t(o,[t(i,[e._v("fa-pencil-alt")]),e._v(" Edit ")],1)],1)],1),t(r,{key:"copy",attrs:{link:""}},[t("router-link",{staticClass:"text-decoration-none",staticStyle:{color:"inherit"},attrs:{to:{name:"credentialNew",params:{copy:!0,id:a.id}}}},[t(o,[t(i,[e._v("fa-clone")]),e._v(" Copy ")],1)],1)],1),t(x,{staticClass:"pb-4"}),t(r,{key:"delete",attrs:{link:""},on:{click:function(n){return e.deleteCredential(a)}}},[t(o,[t(i,[e._v("fa-trash-alt")]),e._v(" Delete ")],1)],1)],1)],1)]}}]),model:{value:e.selected,callback:function(a){e.selected=a},expression:"selected"}})],1)],1)],1)},D=[],P=h(S,E,D,!1,null,null,null,null);const Y=P.exports;export{Y as default};
