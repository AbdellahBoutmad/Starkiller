import{_ as l,a as m}from"./GeneralForm.fe5154ff.js";import{_ as c}from"./InfoViewer.448169ad.js";import{_ as d,a as h,b as _,c as f}from"./ErrorStateAlert.5e9140da.js";import{_ as p}from"./TagViewer.a3da6a20.js";import{_ as u}from"./EditPageTop.30f77a9c.js";import{aH as g,aI as w,q as y,u as $,r as b,aJ as n,aK as T,aL as L,n as v,p as k,b as E,c as x,g as N,h as a,i as o,l as C,f as S}from"./index.85262dd3.js";import{_ as I}from"./VSwitch.8a27782c.js";import"./VSelect.8543571f.js";import"./VExpansionPanels.d99facd5.js";import"./VExpansionPanelHeader.1232ca65.js";import"./TooltipButton.6f10f736.js";import"./VTooltip.0c849a74.js";import"./VBreadcrumbs.32f4f2d0.js";const M={name:"ListenerEdit",components:{TagViewer:p,InfoViewer:c,GeneralForm:l,ErrorStateAlert:d,EditPageTop:u},data(){return{listener:{options:{}},listenerTemplate:{options:{}},selectedTemplate:"",form:{},reset:!0,loading:!1,formPriorities:["Name","Host","Port"],errorState:!1,validationMessage:null,initialLoad:!1,commonStagers:["multi_launcher","multi_macro","windows_csharp_exe","windows_dll","windows_shellcode"]}},computed:{...g({listenerTemplateIds:"listener/templateIds"}),isNew(){return this.$route.name==="listenerNew"},isCopy(){return this.$route.params.copy===!0},mode(){return this.isCopy?"Copy":this.isNew?"New":"View"},canEdit(){return this.isNew||!this.listener.enabled},id(){return this.isCopy?0:this.$route.params.id},copyLink(){return this.id>0?{name:"listenerNew",params:{copy:!0,id:this.id}}:{}},listenerInfo(){if(!this.listenerTemplate)return{};const t=this.listenerTemplate;return{authors:t.authors,description:t.description,comments:t.comments}},listenerOptions(){if(!this.isNew||this.isCopy){const e={};return Object.keys(this.listener.options).forEach(s=>{e[s]={...this.listenerTemplate.options[s]},e[s].value=this.listener.options[s]}),e}const{options:t}=this.listenerTemplate;return t||{}},breads(){return[{text:"Listeners",disabled:!1,to:"/listeners",exact:!0},{text:this.breadcrumbName,disabled:!0,to:"/listeners-edit"}]},breadcrumbName(){return this.isCopy?"New":this.listener.name?this.listener.name:this.id?this.id:"New"}},watch:{selectedTemplate:{async handler(t){const e=await w(t).catch(s=>this.$snack.error(`Error: ${s}`));e&&(this.reset=!1,this.listenerTemplate=e,await this.$nextTick(),this.reset=!0,this.initialLoad=!0)}},id(t){t&&this.getListener(t)}},mounted(){this.$store.dispatch("listener/getListenerTemplates"),(!this.isNew||this.isCopy)&&this.getListener(this.$route.params.id)},methods:{deleteTag(t){y(this.listener.id,t.id).then(()=>{this.listener.tags=this.listener.tags.filter(e=>e.id!==t.id)}).catch(e=>this.$snack.error(`Error: ${e}`))},updateTag(t){$(this.listener.id,t).then(e=>{const s=this.listener.tags.findIndex(i=>i.id===e.id);this.listener.tags.splice(s,1,e),this.$snack.success("Tag updated")}).catch(e=>this.$snack.error(`Error: ${e}`))},addTag(t){b(this.listener.id,t).then(e=>{this.listener.tags.push(e)}).catch(e=>this.$snack.error(`Error: ${e}`))},async submit(){this.loading||!this.$refs.generalform.$refs.form.validate()||(this.loading=!0,this.id>0?n({...this.listener,options:this.form}).then(()=>{this.$snack.success("Listener updated"),this.loading=!1}).catch(t=>{t.startsWith("[*]")?this.validationMessage=t:this.$snack.error(`Error: ${t}`),this.loading=!1}):T(this.selectedTemplate,this.form).then(({id:t})=>{this.$snack.success("Listener created"),this.loading=!1,this.$router.push({name:"listenerEdit",params:{id:t}})}).catch(t=>{t.startsWith("[*]")?this.validationMessage=t:this.$snack.error(`Error: ${t}`),this.loading=!1}))},async kill(){if(await this.$root.$confirm("Delete",`Are you sure you want to kill listener ${this.form.Name}?`,{color:"red"}))try{await this.$store.dispatch("listener/killListener",this.id),this.$router.push({name:"listeners"})}catch(t){this.$snack.error(`Error: ${t}`)}},getListener(t){L(t).then(e=>{this.listener=e,this.listener.tags.forEach(s=>{s.color=s.color||"#0E0CDA"}),this.selectedTemplate=e.template}).catch(()=>{this.errorState=!0})},async toggleEnabled(t){if(this.listener.enabled=t,t===!0&&!await this.$root.$confirm("","Re-enabling the listener will also save any unsaved option changes.",{color:"yellow"})){this.listener.enabled=!t;return}try{const e=await n({...this.listener,options:this.form});this.listener=e}catch(e){this.listener.enabled=!t,this.$snack.error(`Error: ${e}`)}}}};var O=function(){var e=this,s=e._self._c;return s("div",[s(u,{attrs:{breads:e.breads,"show-submit":e.initialLoad,"disable-submit":!e.canEdit&&e.initialLoad,"show-copy":e.id>0&&e.initialLoad,"show-delete":e.id>0&&e.initialLoad,"submit-loading":e.loading,"copy-link":e.copyLink,"small-copy":!0,"small-delete":!0},on:{submit:e.submit,delete:e.kill},scopedSlots:e._u([{key:"extra-stuff",fn:function(){return[s("div",{staticClass:"pt-2",staticStyle:{display:"flex","flex-direction":"row"}},[!e.isNew&&e.initialLoad?s(I,{staticClass:"mr-2",attrs:{color:"green",label:"Enabled"},on:{change:e.toggleEnabled},model:{value:e.listener.enabled,callback:function(i){e.$set(e.listener,"enabled",i)},expression:"listener.enabled"}}):e._e(),!e.isNew&&e.initialLoad?s(k,{attrs:{"offset-y":"","open-on-hover":""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:r}){return[s(E,e._g(e._b({staticClass:"mr-5",attrs:{text:"",icon:"",small:""}},"v-btn",r,!1),i),[s(x,[e._v("fa-suitcase-rolling")])],1)]}}],null,!1,265209208)},[s(N,{staticClass:"ml-2 mr-2"},[e._l(e.commonStagers,function(i,r){return s(a,{key:r,attrs:{link:"",to:{name:"stagerNew",query:{template:i,listener:e.listener.name}}}},[s(o,[e._v(" "+e._s(i)+" ")])],1)}),s(C),s(a,{attrs:{link:"",to:{name:"stagerNew"}}},[s(o,[e._v(" Other ")])],1)],2)],1):e._e()],1)]},proxy:!0}])}),s("div",{staticClass:"headers"},[s("h3",[e._v(e._s(e.mode)+" Listener")])]),e.isNew?e._e():s(p,{attrs:{tags:e.listener.tags},on:{"update-tag":e.updateTag,"delete-tag":e.deleteTag,"new-tag":e.addTag}}),e.errorState?s(d,{attrs:{"resource-id":e.id,"resource-type":"listener"}}):s(S,{staticStyle:{padding:"10px"}},[s(c,{staticClass:"info-viewer",attrs:{info:e.listenerInfo}}),s(m,{attrs:{items:e.listenerTemplateIds,loading:!e.reset,dense:"",outlined:"",label:"Type",readonly:!e.canEdit},model:{value:e.selectedTemplate,callback:function(i){e.selectedTemplate=i},expression:"selectedTemplate"}}),e.validationMessage?s(h,{attrs:{prominent:"",type:"warning"}},[s(_,{attrs:{align:"center"}},[s(f,{staticClass:"grow",staticStyle:{"word-wrap":"word-break",width:"500px"}},[e._v(" "+e._s(e.validationMessage)+" ")])],1)],1):e._e(),e.reset?s(l,{ref:"generalform",attrs:{options:e.listenerOptions,priority:e.formPriorities,readonly:!e.canEdit},model:{value:e.form,callback:function(i){e.form=i},expression:"form"}}):e._e()],1)],1)},P=[],V=v(M,O,P,!1,null,null,null,null);const Q=V.exports;export{Q as default};
